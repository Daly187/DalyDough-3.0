<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DalyDough 2.0 - AI Trading Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #10111a;
            --bg-surface: #1c1d2b;
            --bg-surface-2: #282a3d;
            --border-color: #31334a;
            --text-primary: #f0f0f5;
            --text-secondary: #a8a9b8;
            --text-tertiary: #7b7d94;
            --accent-blue: #367cff;
            --accent-blue-hover: #5a95ff;
            --positive-green: #22c55e;
            --negative-red: #ef4444;
            --warning-yellow: #f59e0b;
            --quality-a: #22c55e;
            --quality-b: #367cff;
            --quality-c: #a8a9b8;
            --sidebar-width-collapsed: 72px;
            --sidebar-width-expanded: 240px;
            --header-height: 80px;
            --font-family: 'Inter', sans-serif;
            --border-radius: 8px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.2s ease-in-out;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-main);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }

        .app-container {
            display: grid;
            grid-template-columns: var(--sidebar-width-collapsed) 1fr;
            grid-template-rows: var(--header-height) 1fr;
            grid-template-areas:
                "sidebar header"
                "sidebar main";
            height: 100vh;
            transition: grid-template-columns var(--transition-speed);
        }

        .app-container.sidebar-expanded {
            grid-template-columns: var(--sidebar-width-expanded) 1fr;
        }

        /* Sidebar */
        .sidebar {
            grid-area: sidebar;
            background-color: var(--bg-surface);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: width var(--transition-speed);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar-header {
            padding: 1.5rem 0;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--accent-blue);
            flex-shrink: 0;
            padding: 0 1.25rem;
            margin-bottom: 2rem;
            cursor: pointer;
        }

        .sidebar-logo svg {
            width: 32px;
            height: 32px;
            flex-shrink: 0;
        }

        .sidebar-logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s var(--transition-speed);
        }

        .app-container.sidebar-expanded .sidebar-logo-text {
            opacity: 1;
        }

        .sidebar-nav {
            width: 100%;
            flex-grow: 1;
        }

        .sidebar-nav-list {
            list-style: none;
        }

        .sidebar-nav-item a {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin: 0.5rem 1.25rem;
            border-radius: var(--border-radius);
            color: var(--text-secondary);
            text-decoration: none;
            gap: 1rem;
            white-space: nowrap;
            transition: background-color var(--transition-speed), color var(--transition-speed);
            cursor: pointer;
        }

        .sidebar-nav-item a:hover {
            background-color: var(--bg-surface-2);
            color: var(--text-primary);
        }

        .sidebar-nav-item a.active {
            background-color: var(--accent-blue);
            color: var(--text-primary);
        }

        .sidebar-nav-item a svg {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        .sidebar-nav-text {
            opacity: 0;
            transition: opacity 0.2s var(--transition-speed);
        }

        .app-container.sidebar-expanded .sidebar-nav-text {
            opacity: 1;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--border-color);
        }

        .account-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: var(--border-radius);
        }

        .account-info svg {
            width: 36px;
            height: 36px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .account-details {
            display: flex;
            flex-direction: column;
            white-space: nowrap;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.2s var(--transition-speed);
        }

        .app-container.sidebar-expanded .account-details {
            opacity: 1;
        }

        .account-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .account-user {
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        /* Header */
        .header {
            grid-area: header;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .current-account-display {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            padding-right: 1.5rem;
            border-right: 1px solid var(--border-color);
        }

        .account-name-header {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .kpi-widgets {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        .kpi-widget {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .kpi-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: 500;
        }

        .kpi-value {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .kpi-value.positive { color: var(--positive-green); }
        .kpi-value.negative { color: var(--negative-red); }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: 1px solid transparent;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed);
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: none;
            font-family: inherit;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background-color: var(--accent-blue);
            color: var(--text-primary);
        }

        .btn-primary:hover {
            background-color: var(--accent-blue-hover);
        }

        .btn-danger {
            background-color: var(--negative-red);
            color: var(--text-primary);
        }

        .btn-danger:hover {
            background-color: #f87171;
        }

        .btn-sm {
            padding: 0.3rem 0.8rem;
            font-size: 0.75rem;
        }

        /* Main Content */
        .main-panel {
            grid-area: main;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .card {
            background-color: var(--bg-surface);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            min-width: 0;
            overflow: hidden;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .last-update {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            font-weight: normal;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            width: 100%;
            margin: 0;
            padding: 0;
            -webkit-overflow-scrolling: touch;
        }

        .table-container table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        thead th {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
            text-transform: uppercase;
            background-color: var(--bg-surface-2);
        }

        tbody tr {
            transition: background-color var(--transition-speed);
            cursor: pointer;
        }

        tbody tr:not(.expanded-row):hover {
            background-color: var(--bg-surface-2);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .sortable-header {
            cursor: pointer;
            user-select: none;
        }

        .sortable-header:hover {
            background-color: var(--border-color);
        }

        /* Price Display */
        .price-cell {
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .current-price {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .price-change {
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 0.25rem;
        }

        .price-change.positive {
            color: var(--positive-green);
        }

        .price-change.negative {
            color: var(--negative-red);
        }

        /* Trend Icons */
        .trend-cell {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            justify-content: center;
        }

        .trend-cell svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .trend-up { color: var(--positive-green); }
        .trend-down { color: var(--negative-red); }
        .trend-neutral { color: var(--text-tertiary); }

        /* Setup Quality Pills */
        .setup-quality-pill {
            font-weight: 700;
            padding: 0.35rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            color: var(--bg-surface);
            min-width: 36px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .quality-A {
            background: linear-gradient(135deg, var(--quality-a), #16a34a);
        }

        .quality-B {
            background: linear-gradient(135deg, var(--quality-b), #2563eb);
        }

        .quality-C {
            background: linear-gradient(135deg, var(--quality-c), #6b7280);
            color: var(--text-primary);
        }

        /* Conditions Icons */
        .conditions-cell {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
        }

        .condition-icon {
            color: var(--text-tertiary);
            transition: color var(--transition-speed);
        }

        .condition-icon.active {
            color: var(--accent-blue);
        }

        .condition-icon svg {
            width: 20px;
            height: 20px;
        }

        /* D-Size Score */
        .recommendation-score {
            font-weight: 700;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            flex-shrink: 0;
            display: inline-block;
            min-width: 40px;
            text-align: center;
        }

        .score-high { background-color: var(--positive-green); color: var(--bg-surface); }
        .score-medium { background-color: var(--warning-yellow); color: var(--bg-surface); }
        .score-low { background-color: var(--negative-red); color: var(--text-primary); }

        /* Expandable Rows */
        tr.is-expandable.active {
            background-color: #2e3047;
            box-shadow: inset 3px 0 0 0 var(--accent-blue);
        }

        .expanded-row td {
            padding: 0 !important;
            border-bottom: 1px solid var(--border-color) !important;
            border-top: 1px solid var(--bg-main) !important;
        }

        .detailed-scoring-card {
            background-color: var(--bg-main);
            padding: 1.5rem;
            border-radius: var(--border-radius);
        }

        .detailed-scoring-card h4 {
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-size: 1.25rem;
            font-weight: 600;
        }

        .detailed-scoring-card table {
            width: 100%;
            margin-bottom: 1rem;
        }

        .detailed-scoring-card th {
            background-color: var(--bg-surface-2);
            padding: 0.75rem 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .detailed-scoring-card td {
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .detailed-scoring-card td:first-child {
            font-weight: 500;
            color: var(--text-primary);
        }

        .detailed-scoring-card td:nth-child(2) {
            color: var(--text-secondary);
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.875rem;
        }

        .detailed-scoring-card td:nth-child(3) {
            font-weight: 600;
            text-align: center;
        }

        .detailed-scoring-card td:nth-child(4) {
            text-align: center;
            font-size: 0.875rem;
        }

        /* D's Riding Hard Table */
        .ds-riding-hard-table .pair-cell {
            min-width: 120px;
        }

        .ds-riding-hard-table .trades-count {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .ds-riding-hard-table .pnl-cell {
            font-weight: 600;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .ds-riding-hard-table .score-cell {
            text-align: center;
        }

        .score-change {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            font-weight: 500;
        }

        .score-change.positive {
            color: var(--positive-green);
        }

        .score-change.negative {
            color: var(--negative-red);
        }

        .table-input {
            background-color: var(--bg-surface-2);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            padding: 0.5rem;
            width: 80px;
            text-align: right;
            transition: all var(--transition-speed);
            min-width: 50px;
            max-width: 100%;
            font-size: 0.875rem;
        }

        .table-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            background-color: var(--bg-main);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-surface-2);
            border: 1px solid var(--border-color);
            transition: .4s;
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: var(--text-secondary);
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(22px);
            background-color: white;
        }

        /* Global Risk Manager */
        .global-risk-manager {
            padding: 1rem 1.5rem;
            margin: 0 -1.5rem 1.5rem -1.5rem;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-main);
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .risk-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .risk-manager-header .card-title {
            margin-bottom: 0;
            font-size: 1.1rem;
        }

        .risk-manager-pnl {
            display: flex;
            gap: 0.5rem;
            align-items: baseline;
        }

        .risk-manager-pnl span:first-child {
            color: var(--text-secondary);
            font-size: 0.875rem;
            white-space: nowrap;
        }

        .risk-manager-pnl .pnl-value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .risk-manager-pnl .pnl-value.positive {
            color: var(--positive-green);
        }

        .risk-manager-pnl .pnl-value.negative {
            color: var(--negative-red);
        }

        .risk-manager-controls {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex-grow: 1;
        }

        .form-group label {
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .form-group input {
            width: 100%;
            max-width: 200px;
            padding: 0.75rem;
            background-color: var(--bg-surface-2);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color var(--transition-speed);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        /* Placeholder Content */
        .placeholder-content {
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            flex-direction: column;
            gap: 1rem;
        }

        .text-secondary {
            color: var(--text-secondary);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            animation: fadeIn 0.6s ease-out;
        }

        /* Enhanced Table Styles */
        .table-container {
            overflow-x: auto;
            width: 100%;
            margin: 0;
            padding: 0;
            -webkit-overflow-scrolling: touch;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }

        .table-container table {
            width: 100%;
            min-width: 900px;
            border-collapse: collapse;
            table-layout: fixed;
            background-color: var(--bg-surface);
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Specific column widths for better layout */
        .market-table th:nth-child(1),
        .market-table td:nth-child(1) {
            width: 10%;
            min-width: 90px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .market-table th:nth-child(2),
        .market-table td:nth-child(2) {
            width: 16%;
            min-width: 130px;
            text-align: center;
        }

        .market-table th:nth-child(3),
        .market-table td:nth-child(3) {
            width: 18%;
            min-width: 140px;
            text-align: center;
        }

        .market-table th:nth-child(4),
        .market-table td:nth-child(4) {
            width: 12%;
            min-width: 100px;
            text-align: center;
        }

        .market-table th:nth-child(5),
        .market-table td:nth-child(5) {
            width: 20%;
            min-width: 160px;
            text-align: center;
        }

        .market-table th:nth-child(6),
        .market-table td:nth-child(6) {
            width: 12%;
            min-width: 90px;
            text-align: center;
        }

        .market-table th:nth-child(7),
        .market-table td:nth-child(7) {
            width: 12%;
            min-width: 100px;
            text-align: center;
        }

        thead th {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            background-color: var(--bg-surface-2);
            border-bottom: 2px solid var(--border-color);
            letter-spacing: 0.5px;
        }

        tbody tr {
            transition: background-color var(--transition-speed);
            cursor: pointer;
            border-bottom: 1px solid rgba(49, 51, 74, 0.3);
        }

        tbody tr:not(.expanded-row):hover {
            background-color: var(--bg-surface-2);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        /* Enhanced Price Display */
        .price-cell {
            font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;
            background-color: rgba(40, 42, 61, 0.3);
            border-radius: 6px;
            padding: 0.75rem;
            margin: 0.25rem 0;
        }

        .current-price {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-primary);
            display: block;
            margin-bottom: 0.25rem;
        }

        .price-change {
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }

        .price-change.positive {
            color: var(--positive-green);
        }

        .price-change.negative {
            color: var(--negative-red);
        }

        /* Enhanced Trend Display */
        .trend-cell {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
        }

        .trend-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .trend-timeframe {
            font-size: 0.65rem;
            color: var(--text-tertiary);
            font-weight: 500;
            text-transform: uppercase;
        }

        .trend-cell svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        /* Enhanced Quality Pills */
        .setup-quality-pill {
            font-weight: 700;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            color: white;
            min-width: 50px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            border: 2px solid transparent;
        }

        .quality-A {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-color: rgba(34, 197, 94, 0.3);
        }

        .quality-B {
            background: linear-gradient(135deg, #367cff, #2563eb);
            border-color: rgba(54, 124, 255, 0.3);
        }

        .quality-C {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            border-color: rgba(107, 114, 128, 0.3);
        }

        /* Enhanced Conditions Display */
        .conditions-cell {
            display: flex;
            gap: 1.25rem;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
        }

        .condition-icon {
            position: relative;
            color: var(--text-tertiary);
            transition: all var(--transition-speed);
            padding: 0.5rem;
            border-radius: 6px;
            background-color: rgba(40, 42, 61, 0.3);
        }

        .condition-icon.active {
            color: var(--accent-blue);
            background-color: rgba(54, 124, 255, 0.15);
            box-shadow: 0 0 0 1px rgba(54, 124, 255, 0.2);
        }

        .condition-icon svg {
            width: 18px;
            height: 18px;
        }

        /* Enhanced D-Size Score */
        .recommendation-score {
            font-weight: 700;
            padding: 0.5rem 0.75rem;
            border-radius: 12px;
            flex-shrink: 0;
            display: inline-block;
            min-width: 50px;
            text-align: center;
            font-size: 0.95rem;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .score-high { 
            background: linear-gradient(135deg, var(--positive-green), #16a34a); 
            color: white;
        }
        .score-medium { 
            background: linear-gradient(135deg, var(--warning-yellow), #d97706); 
            color: white;
        }
        .score-low { 
            background: linear-gradient(135deg, var(--negative-red), #dc2626); 
            color: white;
        }

        /* Enhanced Entry Status */
        .entry-status {
            font-weight: 700;
            font-size: 0.85rem;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .entry-allow {
            background: linear-gradient(135deg, var(--positive-green), #16a34a);
            color: white;
            box-shadow: 0 3px 8px rgba(34, 197, 94, 0.3);
        }

        .entry-block {
            background: linear-gradient(135deg, var(--negative-red), #dc2626);
            color: white;
            box-shadow: 0 3px 8px rgba(239, 68, 68, 0.3);
        }

        /* Pair selector enhancement */
        .pair-option-count {
            color: var(--accent-blue);
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* Bot Launcher Modal */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(16, 17, 26, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.2s ease-in-out;
        }

        .modal-backdrop.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .modal-content {
            background-color: var(--bg-surface);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            transform: scale(1);
            transition: transform 0.2s ease-in-out;
        }

        .modal-backdrop.hidden .modal-content {
            transform: scale(0.95);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            line-height: 1;
            cursor: pointer;
            padding: 0.5rem;
            transition: color var(--transition-speed);
            border-radius: var(--border-radius);
        }

        .modal-close:hover {
            color: var(--text-primary);
            background-color: var(--bg-surface-2);
        }

        .modal-body {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.25rem;
        }

        .form-toggles {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }

        .form-toggle-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: var(--bg-main);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            gap: 1rem;
        }

        .setting-label {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            margin-right: auto;
        }

        .setting-label > span:first-of-type {
            font-weight: 500;
            color: var(--text-primary);
        }

        .setting-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .setting-control-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
        }

        .setting-control-group .trailing-profit-pips {
            background-color: var(--bg-surface-2);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            width: 80px;
            padding: 0.5rem;
            font-size: 0.875rem;
            text-align: center;
            transition: all var(--transition-speed);
        }

        .setting-control-group .trailing-profit-pips:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .setting-control-group .trailing-profit-pips:disabled {
            background-color: var(--bg-main);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .score-threshold-container {
            margin-top: 1rem;
            padding: 1rem;
            background-color: var(--bg-main);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }

        .score-threshold-label {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: block;
        }

        .score-threshold-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: var(--bg-surface-2);
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
            cursor: pointer;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-blue);
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid var(--bg-surface);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--accent-blue);
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid var(--bg-surface);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background-color: var(--bg-main);
            border-top: 1px solid var(--border-color);
            border-bottom-left-radius: var(--border-radius);
            border-bottom-right-radius: var(--border-radius);
        }

        .btn-secondary {
            background-color: var(--bg-surface-2);
            color: var(--text-secondary);
            border-color: var(--border-color);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: var(--border-color);
            color: var(--text-primary);
        }

        .refresh-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .refresh-button svg {
            width: 16px;
            height: 16px;
            transition: transform 0.3s ease;
        }

        .refresh-button.refreshing svg {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                grid-template-areas:
                    "header"
                    "main";
            }
            
            .sidebar {
                display: none;
            }
            
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
                height: auto;
            }
            
            .header-left {
                flex-direction: column;
                align-items: stretch;
                width: 100%;
            }
            
            .current-account-display {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding-bottom: 1rem;
                padding-right: 0;
            }
            
            .main-panel {
                padding: 1rem;
                gap: 1rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .table-container table {
                min-width: 600px;
            }
            
            .table-container table th,
            .table-container table td {
                padding: 0.5rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="app-container" id="app-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-logo" onclick="toggleSidebar()">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5-10-5-10 5zM12 14.47l-8-4v3.06l8 4 8-4v-3.06l-8 4z"></path>
                        </svg>
                        <span class="sidebar-logo-text">DalyDough</span>
                    </div>
                </div>
                <nav class="sidebar-nav">
                    <ul class="sidebar-nav-list">
                        <li class="sidebar-nav-item">
                            <a href="#" data-page="Dashboard" class="active">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                                <span class="sidebar-nav-text">Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-nav-item">
                            <a href="#" data-page="DCA Bots">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    <path d="M12 16a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path>
                                </svg>
                                <span class="sidebar-nav-text">DCA Bots</span>
                            </a>
                        </li>
                        <li class="sidebar-nav-item">
                            <a href="#" data-page="Meat Market">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M2.5 2v6h6m13 14v-6h-6"></path>
                                    <path d="M21.5 2l-8.2 8.2a2 2 0 0 0 0 2.8L16 15.7a2 2 0 0 1 0 2.8l-2.8 2.8a2 2 0 0 1-2.8 0L2.5 12.5a2 2 0 0 0-2.8 0L2 14.2"></path>
                                </svg>
                                <span class="sidebar-nav-text">Meat Market</span>
                            </a>
                        </li>
                        <li class="sidebar-nav-item">
                            <a href="#" data-page="COT Report">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                                </svg>
                                <span class="sidebar-nav-text">COT Report</span>
                            </a>
                        </li>
                        <li class="sidebar-nav-item">
                            <a href="#" data-page="Statistics">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 20V10"></path>
                                    <path d="M18 20V4"></path>
                                    <path d="M6 20V16"></path>
                                </svg>
                                <span class="sidebar-nav-text">Statistics</span>
                            </a>
                        </li>
                        <li class="sidebar-nav-item">
                            <a href="#" data-page="Settings">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82-.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06-.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                </svg>
                                <span class="sidebar-nav-text">Settings</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                <div class="sidebar-footer">
                    <div class="account-info">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <div class="account-details">
                            <span class="account-name">Primary Alpha</span>
                            <span class="account-user">trader@dalydough.ai</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <div class="current-account-display">
                        <span class="kpi-label">Account</span>
                        <span class="account-name-header">Primary Alpha</span>
                    </div>
                    <div class="kpi-widgets" id="kpi-widgets">
                        <!-- KPI widgets will be populated by JavaScript -->
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-danger">Close All</button>
                    <button class="btn btn-primary" id="launch-new-bot-btn">Launch New Bot</button>
                </div>
            </header>

            <!-- Main Content -->
            <main class="main-panel" id="main-panel">
                <!-- Content will be dynamically loaded here -->
            </main>
        </div>

        <!-- Bot Launcher Modal -->
        <div class="modal-backdrop hidden" id="bot-launcher-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="card-title">Prepare that D!</h2>
                    <button class="modal-close" onclick="closeBotLauncher()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="pair-select">Pair</label>
                        <select id="pair-select" name="pair">
                            <option value="AUD/CAD">AUD/CAD</option>
                            <option value="AUD/CHF">AUD/CHF</option>
                            <option value="AUD/JPY">AUD/JPY</option>
                            <option value="AUD/NZD">AUD/NZD</option>
                            <option value="AUD/USD">AUD/USD</option>
                            <option value="EUR/USD">EUR/USD</option>
                            <option value="GBP/USD">GBP/USD</option>
                            <option value="USD/JPY">USD/JPY</option>
                            <option value="USD/CHF">USD/CHF</option>
                            <option value="USD/CAD">USD/CAD</option>
                            <option value="NZD/USD">NZD/USD</option>
                            <option value="EUR/GBP">EUR/GBP</option>
                            <option value="EUR/JPY">EUR/JPY</option>
                            <option value="GBP/JPY">GBP/JPY</option>
                            <option value="XAU/USD">XAU/USD</option>
                        </select>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="dca-multiplier">DCA Multiplier</label>
                            <input type="number" id="dca-multiplier" value="1.6" step="0.1" min="1.0" max="5.0">
                        </div>
                        <div class="form-group">
                            <label for="step-multiplier">Step Multiplier</label>
                            <input type="number" id="step-multiplier" value="2.0" step="0.1" min="1.0" max="5.0">
                        </div>
                        <div class="form-group">
                            <label for="re-entries">Re-entries</label>
                            <input type="number" id="re-entries" value="5" min="1" max="20">
                        </div>
                        <div class="form-group">
                            <label for="order-size">Initial Order Size</label>
                            <input type="number" id="order-size" value="0.01" step="0.01" min="0.01" max="10">
                        </div>
                        <div class="form-group">
                            <label for="sl-limit">SL Limit ($)</label>
                            <input type="number" id="sl-limit" value="500" min="1" max="10000">
                        </div>
                        <div class="form-group">
                            <label for="tp-limit">TP Limit ($)</label>
                            <input type="number" id="tp-limit" value="1000" min="1" max="20000">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="sleep-hours">Sleep Hours After Trade</label>
                        <input type="number" id="sleep-hours" value="6" min="0" max="48">
                    </div>
                    
                    <div class="form-toggles">
                        <div class="form-toggle-item">
                            <div class="setting-label">
                                <span>Trailing Profit</span>
                                <span class="setting-description">Enables a trailing stop loss by pips.</span>
                            </div>
                            <div class="setting-control-group">
                                <label class="toggle-switch">
                                    <input type="checkbox" class="trailing-profit-toggle" id="trailing-profit-enabled" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <input type="number" class="trailing-profit-pips" id="trailing-profit-pips" value="20" min="1" max="100" placeholder="pips">
                            </div>
                        </div>
                        
                        <div class="form-toggle-item">
                            <div class="setting-label">
                                <span>Re-entry after next S/R</span>
                                <span class="setting-description">Waits for S/R flip to re-enter.</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="reentry-sr">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="form-toggle-item">
                            <div class="setting-label">
                                <span>Avoid High-Impact News</span>
                                <span class="setting-description">Pauses entries 30min around news.</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="avoid-news" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="score-threshold-container">
                        <label class="score-threshold-label">Min. Score Threshold</label>
                        <div class="score-threshold-value" id="score-threshold-value">7.0</div>
                        <input type="range" id="score-threshold" min="4.0" max="9.5" step="0.5" value="7.0">
                        <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                            Only launch when D-Size score meets this threshold
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeBotLauncher()">Cancel</button>
                    <button class="btn btn-primary" onclick="launchBot()">Launch</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let appState = {
            activePage: 'Dashboard',
            expandedTrendPair: null,
            marketDataSort: {
                column: 'dsize',
                direction: 'desc'
            },
            marketTrendsData: null,
            activeBots: [],
            sidebarExpanded: false
        };

        // SVG Icons
        const icons = {
            arrowUp: `<svg viewBox="0 0 24 24" fill="currentColor" class="trend-up"><path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"></path></svg>`,
            arrowDown: `<svg viewBox="0 0 24 24" fill="currentColor" class="trend-down"><path d="M12 16l-6-6 1.41-1.41L12 13.17l4.59-4.58L18 10l-6 6z"></path></svg>`,
            neutral: `<svg viewBox="0 0 24 24" fill="currentColor" class="trend-neutral"><path d="M4 11h16v2H4z"></path></svg>`,
            brain: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.94.44c-.22-.67-.22-1.42 0-2.08.33-1 .67-2 .67-3 0-1-.33-2-.67-3-.22-.67-.22-1.42 0-2.08A2.5 2.5 0 0 1 9.5 2z"></path><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.94.44c.22-.67.22-1.42 0-2.08-.33-1-.67-2-.67-3 0-1 .33-2 .67-3 .22-.67-.22-1.42 0-2.08A2.5 2.5 0 0 0 14.5 2z"></path></svg>`,
            bolt: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>`,
            resizeHorizontal: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 8 21 12 17 16"></polyline><polyline points="7 8 3 12 7 16"></polyline><line x1="3" y1="12" x2="21" y2="12"></line></svg>`
        };

        // D-Size Scoring Functions
        function generateScoringBreakdown(pair) {
            const cotScore = Math.random() > 0.6 ? 2 : Math.random() > 0.3 ? 1 : 0;
            const trendScore = Math.floor(Math.random() * 4);
            const adxValue = Math.random() * 50 + 10;
            const adxScore = adxValue >= 20 ? 1 : 0;
            const supportScore = Math.random() > 0.5 ? 2 : Math.random() > 0.3 ? 1 : 0;
            const structureScore = Math.random() > 0.4 ? 1 : 0;
            const spreadValue = Math.random() * 2 + 0.5;
            const spreadScore = spreadValue < 1.5 ? 1 : 0;

            return {
                cotBias: {
                    score: cotScore,
                    value: cotScore === 2 ? 'Strong Bias' : cotScore === 1 ? 'Weak Bias' : 'No Bias',
                    description: 'Weekly directional bias from COT data'
                },
                trendConfirmation: {
                    score: trendScore,
                    value: `${trendScore}/3 timeframes aligned`,
                    description: '+1 for each aligned timeframe (4H, 1D, 1W)'
                },
                adxStrength: {
                    score: adxScore,
                    value: adxValue.toFixed(1),
                    description: 'ADX  20 confirms healthy trend'
                },
                supportRetest: {
                    score: supportScore,
                    value: supportScore === 2 ? 'Valid Retest' : supportScore === 1 ? 'Near Support' : 'No Support',
                    description: 'Price near confirmed support level'
                },
                priceStructure: {
                    score: structureScore,
                    value: structureScore ? 'Clean Structure' : 'Choppy Structure',
                    description: 'HH/HL or LH/LL pattern confirmed'
                },
                spreadCheck: {
                    score: spreadScore,
                    value: `${spreadValue.toFixed(1)} pips`,
                    description: 'Spread < 1.5 pips ensures low-cost execution'
                }
            };
        }

        function calculateDSize(breakdown) {
            return breakdown.cotBias.score + 
                   breakdown.trendConfirmation.score + 
                   breakdown.adxStrength.score + 
                   breakdown.supportRetest.score + 
                   breakdown.priceStructure.score + 
                   breakdown.spreadCheck.score;
        }

        function generateMarketDataWithScoring() {
            const pairs = [
                'EUR/USD', 'GBP/USD', 'USD/JPY', 'USD/CHF', 'AUD/USD', 'USD/CAD',
                'NZD/USD', 'EUR/GBP', 'EUR/JPY', 'GBP/JPY', 'XAU/USD', 'GBP/CHF'
            ];
            
            const trends = ['Up', 'Down', 'Neutral'];
            
            return pairs.map(pair => {
                const breakdown = generateScoringBreakdown(pair);
                const dsize = calculateDSize(breakdown);
                const currentPrice = Math.random() * 2 + 1;
                const dailyChange = (Math.random() - 0.5) * 0.02;
                const dailyChangePercent = (dailyChange / currentPrice) * 100;
                
                return {
                    pair,
                    trendH4: trends[Math.floor(Math.random() * trends.length)],
                    trendD1: trends[Math.floor(Math.random() * trends.length)],
                    trendW1: trends[Math.floor(Math.random() * trends.length)],
                    setupQuality: dsize >= 8 ? 'A' : dsize >= 6 ? 'B' : 'C',
                    conditions: {
                        cot: breakdown.cotBias.score > 0,
                        adx: breakdown.adxStrength.score > 0,
                        spread: breakdown.spreadCheck.score > 0
                    },
                    dsize: dsize.toFixed(1),
                    currentPrice,
                    dailyChange,
                    dailyChangePercent,
                    breakdown,
                    lastUpdated: new Date().toISOString()
                };
            }).sort((a, b) => parseFloat(b.dsize) - parseFloat(a.dsize));
        }

        // Generate mock active bots
        function generateActiveBots() {
            const pairs = ['EUR/USD', 'GBP/USD', 'USD/JPY', 'AUD/USD', 'XAU/USD'];
            const types = ['Dynamic DCA', 'Static Grid', 'AI Trend'];
            
            return pairs.map((pair, i) => {
                const totalPL = (Math.random() - 0.4) * 500;
                const entryDScore = Math.random() * 3 + 7;
                const currentDScore = entryDScore + (Math.random() - 0.5) * 2;
                
                return {
                    id: `bot_${i}`,
                    pair,
                    type: types[Math.floor(Math.random() * types.length)],
                    totalPL,
                    status: 'active',
                    entryDScore,
                    currentDScore: Math.max(0, Math.min(10, currentDScore)),
                    globalSL: Math.floor(Math.random() * 500) + 100,
                    globalTP: Math.floor(Math.random() * 1000) + 200,
                    trailingProfitEnabled: Math.random() > 0.5,
                    closeAtNextTP: Math.random() > 0.7,
                    activeTrades: [{
                        id: `${i}_trade_1`,
                        botId: `bot_${i}`,
                        pair,
                        direction: 'buy',
                        entryPrice: 1.25000,
                        lotSize: 0.01,
                        sl: 500,
                        tp: 1000,
                        currentPL: totalPL,
                        isReentry: false,
                        reentryLevel: 0,
                        entryTime: new Date().toISOString(),
                        score: entryDScore,
                        reason: 'Initial entry based on D-size criteria'
                    }],
                    lastUpdate: new Date().toISOString()
                };
            });
        }

        // Utility Functions
        function getTrendIcon(trend) {
            if (trend === 'Up') return icons.arrowUp;
            if (trend === 'Down') return icons.arrowDown;
            return icons.neutral;
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(value);
        }

        // UI Creation Functions
        function createDetailedScoringCard(trend) {
            const totalScore = parseFloat(trend.dsize);
            const canEnter = totalScore >= 7;
            
            return `
                <div class="detailed-scoring-card">
                    <h4>D-Size Breakdown for ${trend.pair}</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Component</th>
                                <th>Value</th>
                                <th>Score</th>
                                <th>Max</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(trend.breakdown).map(([key, component]) => `
                                <tr>
                                    <td>${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</td>
                                    <td>${component.value}</td>
                                    <td style="color: ${component.score > 0 ? 'var(--positive-green)' : 'var(--text-tertiary)'};">
                                        +${component.score}
                                    </td>
                                    <td style="color: var(--text-secondary);">
                                        /${key === 'cotBias' || key === 'supportRetest' ? '2' : key === 'trendConfirmation' ? '3' : '1'}
                                    </td>
                                </tr>
                            `).join('')}
                            <tr style="border-top: 2px solid var(--border-color); font-weight: 700;">
                                <td>Total D-Size</td>
                                <td>-</td>
                                <td style="color: var(--accent-blue); font-size: 1.1rem;">${trend.dsize}</td>
                                <td style="color: var(--text-secondary);">/10</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 1rem; padding: 1rem; background: ${canEnter ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; border-radius: 6px; border-left: 4px solid ${canEnter ? 'var(--positive-green)' : 'var(--negative-red)'};">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Entry Decision:</strong> Score  7.0 required for new positions
                            </div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: ${canEnter ? 'var(--positive-green)' : 'var(--negative-red)'};">
                                ${canEnter ? ' ENTRY ALLOWED' : ' ENTRY BLOCKED'}
                            </div>
                        </div>
                        ${!canEnter ? `
                            <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">
                                Need ${(7 - totalScore).toFixed(1)} more points to meet entry criteria
                            </div>
                        ` : ''}
                    </div>
                    <div style="margin-top: 1rem; font-size: 0.75rem; color: var(--text-tertiary);">
                        Last updated: ${new Date(trend.lastUpdated).toLocaleString()}
                    </div>
                </div>
            `;
        }

        function createDsRidingHardTable(activeBots) {
            return `
                <div class="table-container">
                    <table class="ds-riding-hard-table">
                        <thead>
                            <tr>
                                <th>Pair</th>
                                <th>Type</th>
                                <th>Current P/L ($)</th>
                                <th>Entry D Score</th>
                                <th>Current D Score</th>
                                <th>Global SL ($)</th>
                                <th>Global TP ($)</th>
                                <th>Trailing Profit</th>
                                <th>Close at Next TP</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${activeBots.map(bot => `
                                <tr class="bot-row" data-bot-id="${bot.id}">
                                    <td class="pair-cell">
                                        <strong>${bot.pair}</strong>
                                        <div class="trades-count">${bot.activeTrades.length} open trades</div>
                                    </td>
                                    <td>${bot.type}</td>
                                    <td class="pnl-cell ${bot.totalPL >= 0 ? 'positive' : 'negative'}">
                                        ${bot.totalPL >= 0 ? '+' : ''}${bot.totalPL.toFixed(2)}
                                        <div class="price-change ${bot.totalPL >= 0 ? 'positive' : 'negative'}">
                                            ${bot.totalPL >= 0 ? '' : ''} ${Math.abs((bot.totalPL / 1000) * 100).toFixed(2)}%
                                        </div>
                                    </td>
                                    <td class="score-cell">
                                        <span class="recommendation-score score-${bot.entryDScore >= 8 ? 'high' : bot.entryDScore >= 6 ? 'medium' : 'low'}">
                                            ${bot.entryDScore.toFixed(1)}
                                        </span>
                                    </td>
                                    <td class="score-cell">
                                        <span class="recommendation-score score-${bot.currentDScore >= 8 ? 'high' : bot.currentDScore >= 6 ? 'medium' : 'low'}">
                                            ${bot.currentDScore.toFixed(1)}
                                        </span>
                                        ${bot.currentDScore !== bot.entryDScore ? 
                                            `<div class="score-change ${bot.currentDScore > bot.entryDScore ? 'positive' : 'negative'}">
                                                ${bot.currentDScore > bot.entryDScore ? '' : ''} 
                                                ${Math.abs(bot.currentDScore - bot.entryDScore).toFixed(1)}
                                            </div>` : ''
                                        }
                                    </td>
                                    <td class="sl-cell">
                                        <input type="number" 
                                               class="table-input global-sl-input" 
                                               value="${bot.globalSL}" 
                                               data-bot-id="${bot.id}"
                                               step="0.01"
                                               min="0">
                                    </td>
                                    <td class="tp-cell">
                                        <input type="number" 
                                               class="table-input global-tp-input" 
                                               value="${bot.globalTP}" 
                                               data-bot-id="${bot.id}"
                                               step="0.01"
                                               min="0">
                                    </td>
                                    <td class="trailing-cell">
                                        <label class="toggle-switch">
                                            <input type="checkbox" 
                                                   class="trailing-toggle" 
                                                   data-bot-id="${bot.id}"
                                                   ${bot.trailingProfitEnabled ? 'checked' : ''}>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </td>
                                    <td class="close-tp-cell">
                                        <label class="toggle-switch">
                                            <input type="checkbox" 
                                                   class="close-tp-toggle" 
                                                   data-bot-id="${bot.id}"
                                                   ${bot.closeAtNextTP ? 'checked' : ''}>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </td>
                                    <td class="actions-cell">
                                        <button class="btn btn-danger btn-sm close-now-btn" data-bot-id="${bot.id}">
                                            Close Now
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function createGlobalRiskManager(activeBots) {
            const totalPnl = activeBots.reduce((sum, bot) => sum + bot.totalPL, 0);
            const stopLossThreshold = -500;
            const isBreached = totalPnl <= stopLossThreshold;

            return `
                <div class="global-risk-manager ${isBreached ? 'breached' : ''}" data-stop-loss="${stopLossThreshold}">
                    <div class="risk-manager-header">
                        <h3 class="card-title">Global Risk Monitor</h3>
                        <div class="risk-manager-pnl">
                            <span>Total Active P/L:</span>
                            <span class="pnl-value ${totalPnl >= 0 ? 'positive' : 'negative'}">${formatCurrency(totalPnl)}</span>
                        </div>
                    </div>
                    <div class="risk-manager-controls">
                        <div class="form-group">
                            <label for="global-sl-input">Global Stop Loss ($)</label>
                            <input type="number" id="global-sl-input" class="global-sl-input" value="${stopLossThreshold}">
                        </div>
                        <button class="btn btn-danger close-all-bots-btn">Close All Positions</button>
                    </div>
                </div>
            `;
        }

        // Page Creation Functions
        function createDashboardPage() {
            if (!appState.marketTrendsData) {
                appState.marketTrendsData = generateMarketDataWithScoring();
            }
            if (!appState.activeBots.length) {
                appState.activeBots = generateActiveBots();
            }

            const topTrends = appState.marketTrendsData.slice(0, 8);

            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Meat Market</h2>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="last-update">
                                Last Update: ${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                            </div>
                            <button class="btn btn-secondary refresh-button" onclick="refreshMarketData()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 4v6h-6"></path>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                </svg>
                                Refresh
                            </button>
                        </div>
                            <button class="btn btn-secondary refresh-button" onclick="refreshMarketData()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 4v6h-6"></path>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    ${createMarketTrendsTable(topTrends)}
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">D's Riding Hard</h2>
                    </div>
                    ${createGlobalRiskManager(appState.activeBots)}
                    ${createDsRidingHardTable(appState.activeBots)}
                </div>
            `;
        }

        function createMarketTrendsTable(data) {
            const sortIcon = (column) => {
                if (appState.marketDataSort.column !== column) return '';
                return appState.marketDataSort.direction === 'asc' ? '' : '';
            };

            const sortedData = [...data].sort((a, b) => {
                const { column, direction } = appState.marketDataSort;
                const asc = direction === 'asc' ? 1 : -1;

                switch (column) {
                    case 'pair':
                        return a.pair.localeCompare(b.pair) * asc;
                    case 'setupQuality':
                        const qualityOrder = { 'A': 3, 'B': 2, 'C': 1 };
                        return (qualityOrder[a.setupQuality] - qualityOrder[b.setupQuality]) * asc;
                    case 'dsize':
                        return (parseFloat(a.dsize) - parseFloat(b.dsize)) * asc;
                    default:
                        return 0;
                }
            });

            return `
                <div class="table-container">
                    <table class="market-table">
                        <thead>
                            <tr>
                                <th class="sortable-header" data-sort="pair">Pair ${sortIcon('pair')}</th>
                                <th>Price / Change</th>
                                <th>Trend Analysis</th>
                                <th class="sortable-header" data-sort="setupQuality">Quality ${sortIcon('setupQuality')}</th>
                                <th>Market Conditions</th>
                                <th class="sortable-header" data-sort="dsize">D-Size ${sortIcon('dsize')}</th>
                                <th>Entry Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedData.map(d => {
                                const isExpanded = appState.expandedTrendPair === d.pair;
                                const canEnter = parseFloat(d.dsize) >= 7;
                                
                                return `
                                    <tr class="is-expandable ${isExpanded ? 'active' : ''}" data-pair='${JSON.stringify(d).replace(/'/g, "&#39;")}'>
                                        <td>${d.pair}</td>
                                        <td>
                                            <div class="price-cell">
                                                <span class="current-price">${d.currentPrice.toFixed(5)}</span>
                                                <div class="price-change ${d.dailyChange >= 0 ? 'positive' : 'negative'}">
                                                    ${d.dailyChange >= 0 ? '' : ''} ${Math.abs(d.dailyChange).toFixed(4)} 
                                                    (${d.dailyChangePercent >= 0 ? '+' : ''}${d.dailyChangePercent.toFixed(2)}%)
                                                </div>
                                            </div>
                                        </td>
                                        <td class="trend-cell">
                                            <div class="trend-indicator">
                                                <div class="trend-timeframe">W1</div>
                                                ${getTrendIcon(d.trendW1)}
                                            </div>
                                            <div class="trend-indicator">
                                                <div class="trend-timeframe">D1</div>
                                                ${getTrendIcon(d.trendD1)}
                                            </div>
                                            <div class="trend-indicator">
                                                <div class="trend-timeframe">H4</div>
                                                ${getTrendIcon(d.trendH4)}
                                            </div>
                                        </td>
                                        <td><span class="setup-quality-pill quality-${d.setupQuality}">${d.setupQuality}</span></td>
                                        <td class="conditions-cell">
                                            <span class="condition-icon ${d.conditions.cot ? 'active' : ''}" title="COT Bias">${icons.brain}</span>
                                            <span class="condition-icon ${d.conditions.adx ? 'active' : ''}" title="ADX Strength">${icons.bolt}</span>
                                            <span class="condition-icon ${d.conditions.spread ? 'active' : ''}" title="Spread Check">${icons.resizeHorizontal}</span>
                                        </td>
                                        <td><span class="recommendation-score score-${Number(d.dsize) >= 8 ? 'high' : Number(d.dsize) >= 6 ? 'medium' : 'low'}">${d.dsize}</span></td>
                                        <td>
                                            <div class="entry-status ${canEnter ? 'entry-allow' : 'entry-block'}">
                                                ${canEnter ? ' Allow' : ' Block'}
                                            </div>
                                        </td>
                                    </tr>
                                    ${isExpanded ? `<tr class="expanded-row"><td colspan="7">${createDetailedScoringCard(d)}</td></tr>` : ''}
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function createPlaceholderPage(pageName) {
            const descriptions = {
                'DCA Bots': 'Manage all your DCA trading bots, view performance, and configure strategies.',
                'Meat Market': 'Full market analysis with D-Size scoring and real-time forex data.',
                'COT Report': 'Commitments of Traders report analysis and institutional positioning data.',
                'Statistics': 'Comprehensive trading statistics, performance metrics, and analytics.',
                'Settings': 'Application settings, API configurations, and user preferences.'
            };

            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">${pageName}</h2>
                    </div>
                    <div class="placeholder-content">
                        <h3>Coming Soon</h3>
                        <p class="text-secondary">${descriptions[pageName]}</p>
                        <button class="btn btn-primary" style="margin-top: 1rem;">Get Started</button>
                    </div>
                </div>
            `;
        }

        // Bot Launcher Functions
        function openBotLauncher() {
            const modal = document.getElementById('bot-launcher-modal');
            modal.classList.remove('hidden');
            
            // Update pair dropdown with bot counts and filter blocked pairs
            updatePairDropdown();
            
            // Update trailing profit pips state
            updateTrailingProfitState();
        }

        function updatePairDropdown() {
            const pairSelect = document.getElementById('pair-select');
            if (!pairSelect) return;
            
            // Get bot counts per pair
            const botCounts = {};
            appState.activeBots.forEach(bot => {
                botCounts[bot.pair] = (botCounts[bot.pair] || 0) + 1;
            });
            
            // Get market data for D-Size filtering
            const marketData = appState.marketTrendsData || [];
            const marketDataMap = new Map(marketData.map(d => [d.pair, d]));
            
            // Get current score threshold from slider
            const scoreThreshold = parseFloat(document.getElementById('score-threshold')?.value || '7.0');
            
            // Available pairs from market data
            const availablePairs = [
                'AUD/CAD', 'AUD/CHF', 'AUD/JPY', 'AUD/NZD', 'AUD/USD',
                'EUR/USD', 'GBP/USD', 'USD/JPY', 'USD/CHF', 'USD/CAD',
                'NZD/USD', 'EUR/GBP', 'EUR/JPY', 'GBP/JPY', 'XAU/USD',
                'GBP/CHF'
            ];
            
            // Filter pairs based on D-Size score threshold
            const allowedPairs = availablePairs.filter(pair => {
                const marketInfo = marketDataMap.get(pair);
                if (!marketInfo) return false; // No market data, block
                return parseFloat(marketInfo.dsize) >= scoreThreshold;
            });
            
            // Build options HTML
            const options = allowedPairs.map(pair => {
                const count = botCounts[pair] || 0;
                const countText = count > 0 ? ` <span class="pair-option-count">(${count})</span>` : '';
                return `<option value="${pair}">${pair}${countText}</option>`;
            }).join('');
            
            pairSelect.innerHTML = options;
            
            // Show message if no pairs are available
            if (allowedPairs.length === 0) {
                pairSelect.innerHTML = '<option disabled>No pairs meet D-Size threshold</option>';
            }
        }

        function closeBotLauncher() {
            const modal = document.getElementById('bot-launcher-modal');
            modal.classList.add('hidden');
        }

        function updateTrailingProfitState() {
            const toggle = document.getElementById('trailing-profit-enabled');
            const pipsInput = document.getElementById('trailing-profit-pips');
            
            if (toggle && pipsInput) {
                pipsInput.disabled = !toggle.checked;
                if (!toggle.checked) {
                    pipsInput.style.opacity = '0.5';
                } else {
                    pipsInput.style.opacity = '1';
                }
            }
        }

        function launchBot() {
            const formData = {
                pair: document.getElementById('pair-select').value,
                dcaMultiplier: parseFloat(document.getElementById('dca-multiplier').value),
                stepMultiplier: parseFloat(document.getElementById('step-multiplier').value),
                reEntries: parseInt(document.getElementById('re-entries').value),
                orderSize: parseFloat(document.getElementById('order-size').value),
                slLimit: parseFloat(document.getElementById('sl-limit').value),
                tpLimit: parseFloat(document.getElementById('tp-limit').value),
                sleepHours: parseInt(document.getElementById('sleep-hours').value),
                trailingProfitEnabled: document.getElementById('trailing-profit-enabled').checked,
                trailingProfitPips: parseInt(document.getElementById('trailing-profit-pips').value),
                reentrySR: document.getElementById('reentry-sr').checked,
                avoidNews: document.getElementById('avoid-news').checked,
                scoreThreshold: parseFloat(document.getElementById('score-threshold').value)
            };

            console.log(' Launching new bot with configuration:', formData);
            
            // Validate form
            if (!formData.pair) {
                alert('Please select a valid pair that meets the D-Size threshold.');
                return;
            }
            
            // Get current D-Size for the pair
            const marketData = appState.marketTrendsData || [];
            const pairData = marketData.find(d => d.pair === formData.pair);
            const currentDSize = pairData ? parseFloat(pairData.dsize) : 0;
            
            if (currentDSize < formData.scoreThreshold) {
                alert(`Cannot launch: ${formData.pair} D-Size (${currentDSize}) is below threshold (${formData.scoreThreshold})`);
                return;
            }
            
            // Show success message with S/R info
            alert(`Bot launched for ${formData.pair}!\n\nD-Size: ${currentDSize}/10\nThreshold: ${formData.scoreThreshold}\n\n${formData.reentrySR ? ' Re-entry after S/R: Bot will wait for support/resistance flip before making additional entries.' : ' Standard DCA: Bot will make re-entries based on price levels only.'}`);
            
            closeBotLauncher();
            
            // Add the new bot to active bots
            const newBot = {
                id: `bot_${Date.now()}`,
                pair: formData.pair,
                type: 'Dynamic DCA',
                totalPL: 0,
                status: 'active',
                entryDScore: currentDSize,
                currentDScore: currentDSize,
                globalSL: formData.slLimit,
                globalTP: formData.tpLimit,
                trailingProfitEnabled: formData.trailingProfitEnabled,
                closeAtNextTP: false,
                activeTrades: [{
                    id: `trade_${Date.now()}`,
                    botId: `bot_${Date.now()}`,
                    pair: formData.pair,
                    direction: 'buy',
                    entryPrice: pairData?.currentPrice || 1.0000,
                    lotSize: formData.orderSize,
                    sl: formData.slLimit,
                    tp: formData.tpLimit,
                    currentPL: 0,
                    isReentry: false,
                    reentryLevel: 0,
                    entryTime: new Date().toISOString(),
                    score: currentDSize,
                    reason: `Initial entry - D-Size: ${currentDSize}/10`
                }],
                lastUpdate: new Date().toISOString(),
                reentrySR: formData.reentrySR
            };
            
            appState.activeBots.push(newBot);
            
            // Refresh dashboard if currently viewing it
            if (appState.activePage === 'Dashboard') {
                setTimeout(() => {
                    switchPage('Dashboard');
                }, 500);
            }
        }

        // Event Handlers
        function toggleSidebar() {
            appState.sidebarExpanded = !appState.sidebarExpanded;
            const container = document.getElementById('app-container');
            if (appState.sidebarExpanded) {
                container.classList.add('sidebar-expanded');
            } else {
                container.classList.remove('sidebar-expanded');
            }
        }

        function switchPage(pageName) {
            console.log(` Switching to page: ${pageName}`);
            appState.activePage = pageName;
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar-nav-item a').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === pageName) {
                    link.classList.add('active');
                }
            });

            // Update main content
            const mainPanel = document.getElementById('main-panel');
            if (pageName === 'Dashboard') {
                mainPanel.innerHTML = createDashboardPage();
                attachEventListeners();
            } else if (pageName === 'Meat Market') {
                if (!appState.marketTrendsData) {
                    appState.marketTrendsData = generateMarketDataWithScoring();
                }
                mainPanel.innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Meat Market - Full Analysis</h2>
                            <div class="last-update">
                                Last Update: ${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                            </div>
                        </div>
                        ${createMarketTrendsTable(appState.marketTrendsData)}
                    </div>
                `;
                attachMarketEventListeners();
            } else {
                mainPanel.innerHTML = createPlaceholderPage(pageName);
            }
        }

        function attachEventListeners() {
            // Bot control event listeners
            document.querySelectorAll('.global-sl-input, .global-tp-input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const botId = e.target.dataset.botId;
                    const value = parseFloat(e.target.value);
                    const type = e.target.classList.contains('global-sl-input') ? 'sl' : 'tp';
                    console.log(` Updating bot ${botId} ${type.toUpperCase()} to ${value}`);
                });
            });

            document.querySelectorAll('.trailing-toggle').forEach(toggle => {
                toggle.addEventListener('change', (e) => {
                    const botId = e.target.dataset.botId;
                    console.log(` ${e.target.checked ? 'Enabling' : 'Disabling'} trailing profit for bot ${botId}`);
                });
            });

            document.querySelectorAll('.close-tp-toggle').forEach(toggle => {
                toggle.addEventListener('change', (e) => {
                    const botId = e.target.dataset.botId;
                    console.log(` ${e.target.checked ? 'Enabling' : 'Disabling'} close at next TP for bot ${botId}`);
                });
            });

            document.querySelectorAll('.close-now-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const botId = e.target.dataset.botId;
                    if (confirm('Are you sure you want to close all positions for this pair?')) {
                        console.log(` Closing all positions for bot ${botId}`);
                    }
                });
            });

            // Market trends event listeners
            attachMarketEventListeners();
        }

        function attachMarketEventListeners() {
            // Table row expansion
            document.querySelectorAll('tr.is-expandable').forEach(row => {
                row.addEventListener('click', (e) => {
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;
                    
                    const pairData = JSON.parse(row.dataset.pair);
                    const pair = pairData.pair;
                    
                    if (appState.expandedTrendPair === pair) {
                        appState.expandedTrendPair = null;
                    } else {
                        appState.expandedTrendPair = pair;
                    }
                    
                    // Refresh the current page to show/hide expansion
                    if (appState.activePage === 'Dashboard') {
                        document.getElementById('main-panel').innerHTML = createDashboardPage();
                        attachEventListeners();
                    } else if (appState.activePage === 'Meat Market') {
                        document.getElementById('main-panel').innerHTML = `
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Meat Market - Full Analysis</h2>
                                    <div class="last-update">
                                        Last Update: ${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                                    </div>
                                </div>
                                ${createMarketTrendsTable(appState.marketTrendsData)}
                            </div>
                        `;
                        attachMarketEventListeners();
                    }
                });
            });

            // Sortable headers
            document.querySelectorAll('.sortable-header').forEach(header => {
                header.addEventListener('click', (e) => {
                    const column = e.target.dataset.sort;
                    if (appState.marketDataSort.column === column) {
                        appState.marketDataSort.direction = appState.marketDataSort.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        appState.marketDataSort.column = column;
                        appState.marketDataSort.direction = 'desc';
                    }
                    
                    // Refresh the current page to show new sort
                    if (appState.activePage === 'Dashboard') {
                        document.getElementById('main-panel').innerHTML = createDashboardPage();
                        attachEventListeners();
                    } else if (appState.activePage === 'Meat Market') {
                        document.getElementById('main-panel').innerHTML = `
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Meat Market - Full Analysis</h2>
                                    <div class="last-update">
                                        Last Update: ${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                                    </div>
                                </div>
                                ${createMarketTrendsTable(appState.marketTrendsData)}
                            </div>
                        `;
                        attachMarketEventListeners();
                    }
                });
            });
        }

        function updateKPIWidgets() {
            const kpiData = [
                { label: 'P/L Summary', value: '+$1,284.50', positive: true },
                { label: 'Equity', value: '$11,432.12', positive: null },
                { label: 'Balance', value: '$10,147.62', positive: null },
                { label: 'Margin Use', value: '15.7%', positive: false }
            ];

            const kpiContainer = document.getElementById('kpi-widgets');
            kpiContainer.innerHTML = kpiData.map(kpi => `
                <div class="kpi-widget">
                    <span class="kpi-label">${kpi.label}</span>
                    <span class="kpi-value ${kpi.positive === true ? 'positive' : kpi.positive === false ? 'negative' : ''}">${kpi.value}</span>
                </div>
            `).join('');
        }

        // Auto-refresh functions (only for bot data, not market data)
        function refreshMarketData() {
            console.log(' Manually refreshing market data...');
            
            // Add spinning animation
            const refreshButtons = document.querySelectorAll('.refresh-button');
            refreshButtons.forEach(btn => btn.classList.add('refreshing'));
            
            // Simulate API call delay
            setTimeout(() => {
                appState.marketTrendsData = generateMarketDataWithScoring();
                
                if (appState.activePage === 'Dashboard' || appState.activePage === 'Meat Market') {
                    switchPage(appState.activePage);
                }
                
                // Remove spinning animation
                refreshButtons.forEach(btn => btn.classList.remove('refreshing'));
            }, 800);
        }

        function refreshBotData() {
            console.log(' Auto-refreshing bot data...');
            
            // Generate new bot data with some variations
            appState.activeBots = appState.activeBots.map(bot => ({
                ...bot,
                totalPL: bot.totalPL + (Math.random() - 0.5) * 10, // Small P/L changes
                currentDScore: Math.max(0, Math.min(10, bot.currentDScore + (Math.random() - 0.5) * 0.2)) // Small D-Score changes
            }));
            
            if (appState.activePage === 'Dashboard') {
                // Only update the D's Riding Hard section, not the market data
                const mainPanel = document.getElementById('main-panel');
                const botCard = mainPanel.querySelector('.card:last-child');
                if (botCard) {
                    const newBotCard = document.createElement('div');
                    newBotCard.className = 'card';
                    newBotCard.innerHTML = `
                        <div class="card-header">
                            <h2 class="card-title">D's Riding Hard</h2>
                        </div>
                        ${createGlobalRiskManager(appState.activeBots)}
                        ${createDsRidingHardTable(appState.activeBots)}
                    `;
                    botCard.replaceWith(newBotCard);
                    attachEventListeners();
                }
            }
        }

        // Initialize Application
        function initApp() {
            console.log(' Initializing DalyDough 2.0...');
            
            // Set up sidebar navigation
            document.querySelectorAll('.sidebar-nav-item a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageName = e.currentTarget.dataset.page;
                    switchPage(pageName);
                });
            });

            // Initialize data
            appState.marketTrendsData = generateMarketDataWithScoring();
            appState.activeBots = generateActiveBots();
            
            // Set up bot launcher
            const launchBtn = document.getElementById('launch-new-bot-btn');
            if (launchBtn) {
                launchBtn.addEventListener('click', openBotLauncher);
            }

            // Set up bot launcher form controls
            const trailingToggle = document.getElementById('trailing-profit-enabled');
            if (trailingToggle) {
                trailingToggle.addEventListener('change', updateTrailingProfitState);
            }

            const scoreThresholdSlider = document.getElementById('score-threshold');
            if (scoreThresholdSlider) {
                scoreThresholdSlider.addEventListener('input', (e) => {
                    document.getElementById('score-threshold-value').textContent = e.target.value;
                    // Update pair dropdown when threshold changes
                    updatePairDropdown();
                });
            }

            // Set up modal backdrop click to close
            const modal = document.getElementById('bot-launcher-modal');
            if (modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeBotLauncher();
                    }
                });
            }
            
            // Load initial page
            updateKPIWidgets();
            switchPage('Dashboard');
            
            // Set up auto-refresh intervals (only for bot data, not market data)
            setInterval(refreshBotData, 10000); // Refresh bot data every 10 seconds
            setInterval(updateKPIWidgets, 5000); // Refresh KPIs every 5 seconds
            
            console.log(' DalyDough 2.0 initialized successfully!');
        }

        // Start the application when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        // Global click handler for debugging
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn-primary')) {
                console.log(' Primary button clicked:', e.target.textContent);
            }
            if (e.target.classList.contains('btn-danger')) {
                console.log(' Danger button clicked:', e.target.textContent);
            }
        });

        console.log(' DalyDough 2.0 JavaScript loaded successfully!');
    </script>
</body>
</html>